var e=Object.defineProperty,t=(t,s,i)=>((t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i)(t,"symbol"!=typeof s?s+"":s,i);import{r as s,g as i}from"./phaser-sXZmPM0a.js";import{d as n,T as r,a as o,b as a,e as c,c as l,f as h,g as d,h as u}from"./bitecs-IwnvhaBI.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var g=s();const m=i(g);class f extends g.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}const p=n({x:r.f32,y:r.f32}),w=n({x:r.f32,y:r.f32}),y=n({texture:r.ui8}),k=n({angle:r.f32}),b=n(),x=n({timeBetweenActions:r.ui32,accumulatedTime:r.ui32}),v=n({direction:r.ui8,speed:r.ui8});var R=(e=>(e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=3]="Up",e[e.Down=4]="Down",e))(R||{});class S extends g.Scene{constructor(){super("MainGame"),t(this,"cursors"),t(this,"world"),t(this,"playerSystem"),t(this,"cpuSystem"),t(this,"movementSystem"),t(this,"spriteSystem")}init(){var e,t;this.cursors=null==(t=null==(e=this.input)?void 0:e.keyboard)?void 0:t.createCursorKeys()}create(){this.add.image(512,384,"background");const{width:e,height:t}=this.scale;this.world=h();const s=d(this.world);u(this.world,p,s),u(this.world,w,s),u(this.world,k,s),u(this.world,y,s),u(this.world,b,s),u(this.world,v,s),p.x[s]=100,p.y[s]=100,y.texture[s]=0,v.speed[s]=10;for(let i=0;i<10;++i){const s=d(this.world);u(this.world,p,s),p.x[s]=Phaser.Math.Between(.25*e,.75*e),p.y[s]=Phaser.Math.Between(.25*t,.75*t),u(this.world,w,s),u(this.world,k,s),u(this.world,y,s),y.texture[s]=Phaser.Math.Between(1,2),u(this.world,x,s),x.timeBetweenActions[s]=Phaser.Math.Between(0,500),u(this.world,v,s),v.speed[s]=10}this.cursors&&(this.playerSystem=function(e){const t=o([b,w,k,v]);return a((s=>{const i=t(s);for(let t=0;t<i.length;++t){const s=i[t];e.left.isDown?v.direction[s]=R.Left:e.right.isDown?v.direction[s]=R.Right:e.up.isDown?v.direction[s]=R.Up:e.down.isDown?v.direction[s]=R.Down:v.direction[s]=R.None}return s}))}(this.cursors)),this.cpuSystem=function(e){const t=o([x,w,k,v]);return a((s=>{const i=t(s),n=e.game.loop.delta;for(let e=0;e<i.length;++e){const t=i[e];if(x.accumulatedTime[t]+=n,!(x.accumulatedTime[t]<x.timeBetweenActions[t]))switch(x.accumulatedTime[t]=0,m.Math.Between(0,20)){case 0:v.direction[t]=R.Left;break;case 1:v.direction[t]=R.Right;break;case 2:v.direction[t]=R.Up;break;case 3:v.direction[t]=R.Down;break;default:v.direction[t]=R.None}}return s}))}(this),this.movementSystem=function(){const e=o([p,w,v,k]);return a((t=>{const s=e(t);for(let e=0;e<s.length;++e){const t=s[e],i=v.direction[t],n=v.speed[t];switch(i){case R.None:w.x[t]=0,w.y[t]=0;break;case R.Left:w.x[t]=-n,w.y[t]=0,k.angle[t]=180;break;case R.Right:w.x[t]=n,w.y[t]=0,k.angle[t]=0;break;case R.Up:w.x[t]=0,w.y[t]=-n,k.angle[t]=270;break;case R.Down:w.x[t]=0,w.y[t]=n,k.angle[t]=90}p.x[t]+=w.x[t],p.y[t]+=w.y[t]}return t}))}(),this.spriteSystem=function(e,t){const s=new Map,i=o([p,k,y]),n=c(i),r=l(i);return a((o=>{const a=n(o);for(let i=0;i<a.length;++i){const n=a[i],r=y.texture[n],o=t[r];s.set(n,e.add.sprite(0,0,o))}const c=i(o);for(let e=0;e<c.length;++e){const t=c[e],i=s.get(t);i&&(i.x=p.x[t],i.y=p.y[t],i.angle=k.angle[t])}const l=r(o);for(let e=0;e<l.length;++e){const t=a[e];s.delete(t)}return o}))}(this,["tank-blue","tank-green","tank-red"]),this.input.once("pointerdown",(()=>{this.scene.start("GameOver")}))}update(e,t){var s,i,n,r;this.world&&(null==(s=this.playerSystem)||s.call(this,this.world),null==(i=this.cpuSystem)||i.call(this,this.world),null==(n=this.movementSystem)||n.call(this,this.world),null==(r=this.spriteSystem)||r.call(this,this.world))}}class A extends g.Scene{constructor(){super("GameOver"),t(this,"camera"),t(this,"background"),t(this,"gameover_text")}create(){this.camera=this.cameras.main,this.background=this.add.image(512,384,"background"),this.gameover_text=this.add.text(512,384,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}}class B extends g.Scene{constructor(){super("MainMenu"),t(this,"background"),t(this,"logo"),t(this,"title")}create(){this.background=this.add.image(512,384,"background"),this.logo=this.add.image(512,300,"logo"),this.title=this.add.text(512,460,"Main Menu",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MainGame")}))}}const M=class e extends g.Scene{constructor(){super("Preloader")}init(){this.add.image(this.game.canvas.width/2,this.game.canvas.height/2,"background"),this.add.rectangle(this.game.canvas.width/2,this.game.canvas.height/2,e.BAR_WIDTH,e.BAR_HEIGHT).setStrokeStyle(2,16777215);const t=this.add.rectangle(this.game.canvas.width/2-e.BAR_WIDTH/2+e.INNER_BAR_MARGIN,this.game.canvas.height/2,0,e.BAR_HEIGHT-2*e.INNER_BAR_MARGIN,16777215);this.load.on("progress",(s=>{t.width=(e.BAR_WIDTH-2*e.INNER_BAR_MARGIN)*s}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("tank-blue","tank_blue.png"),this.load.image("tank-green","tank_green.png"),this.load.image("tank-red","tank_red.png")}create(){this.scene.start("MainMenu")}};t(M,"BAR_WIDTH",464),t(M,"BAR_HEIGHT",32),t(M,"INNER_BAR_MARGIN",2);let _=M;document.addEventListener("DOMContentLoaded",(function(){new g.Game({type:Phaser.AUTO,width:1024,height:768,title:"Scoundrel",pixelArt:!0,roundPixels:!0,parent:"game-container",backgroundColor:"#000",scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},scene:[f,_,B,S,A]})}));
